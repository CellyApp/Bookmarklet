var funcs={getArguments:function(){var d={};var c=window.location.search.substring(1);var e=c.split("&");for(var b=0;b<e.length;b++){var f=e[b].split("=");if(typeof d[f[0]]==="undefined"){d[f[0]]=f[1]}else{if(typeof d[f[0]]==="string"){var a=[d[f[0]],f[1]];d[f[0]]=a}else{d[f[0]].push(f[1])}}}return d},getCookie:function(b){var c=document.cookie;var d=c.indexOf(" "+b+"=");if(d==-1){d=c.indexOf(b+"=")}if(d==-1){c=null}else{d=c.indexOf("=",d)+1;var a=c.indexOf(";",d);if(a==-1){a=c.length}c=unescape(c.substring(d,a))}return c},setCookie:function(a,c){var b=escape(c);document.cookie=a+"="+b+";domain="+vars.domain+";path=/"},deleteCookie:function(a){document.cookie=a+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;domain="+vars.domain+";path=/"},getMe:function(a){funcs.requestAPI("x-www","/me?oauth_token="+vars.accTok,"",function(b){if(b.response&&b.response.cells){vars.me=b.response;if(a){a()}}else{funcs.deleteCookie(vars.accTokCookie);document.location.href=vars.apiURL+"/authorize?client_id="+vars.client_id+"&redirect_uri="+vars.redirectURL+"&scope=BASIC"}},"GET")},serialize:function(c,a){var d=[];for(var b in c){d.push(b+"="+(typeof c[b]=="object"?encodeURIComponent(JSON.stringify(c[b])):c[b]))}return d.join("&")},detectBrowser:function(){var a=3,c=document.createElement("div"),b=c.getElementsByTagName("i");while(c.innerHTML="<!--[if gt IE "+(++a)+"]><i></i><![endif]-->",b[0]){}return a>4?a:false},requestAPI:function(e,h,d,g,i){var c=JSON.stringify(d);var b=(typeof i!="undefined"?i:"POST");var a=vars.apiURL+h;if(b=="POST"&&vars.ie&&vars.ie<=9&&e=="json"){e="x-www"}var f=(e=="json"?c:funcs.serialize(d));$.ajax({type:b,url:a,data:f,dataType:"json",cache:false,contentType:"application/"+(e=="json"?"json":"x-www-form-urlencoded"),success:g,error:funcs.onError})},onError:function(c,a,b){console.log("Error status: "+a);console.log("Error: "+b)},init:function(b){b=b||function(){};vars.accTok=funcs.getCookie("access_token");if(vars.accTok==null){if(typeof vars.QueryString.code=="undefined"){document.location.href=vars.apiURL+"/authorize?client_id="+vars.client_id+"&redirect_uri="+vars.redirectURL+"&scope=BASIC"}var a={client_id:vars.client_id,client_secret:vars.client_secret,grant_type:"authorization_code",redirect_uri:"blah",code:vars.QueryString.code};funcs.requestAPI("x-www","/token",a,function(c){vars.accTok=c.access_token;if(vars.accTok!=null&&typeof vars.accTok!="undefined"){funcs.setCookie(vars.accTokCookie,vars.accTok)}funcs.getMe(b)})}else{funcs.getMe(b)}}};vars.QueryString=funcs.getArguments();vars.ie=funcs.detectBrowser();